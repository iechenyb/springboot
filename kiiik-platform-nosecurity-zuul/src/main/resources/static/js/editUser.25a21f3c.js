(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["editUser"],{5960:function(e,t,r){},6531:function(e,t,r){"use strict";r.r(t);var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"editUser"},[r("h1",[e._v("用户编辑")]),r("el-form",{staticClass:"demo-form-inline",attrs:{inline:!0,model:e.search}},[r("el-form-item",[r("el-input",{attrs:{placeholder:"搜索账号"},model:{value:e.search.empNo,callback:function(t){e.$set(e.search,"empNo",t)},expression:"search.empNo"}})],1),r("el-form-item",[r("el-input",{attrs:{placeholder:"搜索姓名"},model:{value:e.search.userName,callback:function(t){e.$set(e.search,"userName",t)},expression:"search.userName"}})],1),r("el-form-item",{staticClass:"add"},[r("el-button",{attrs:{type:"primary"},on:{click:function(t){e.showDialog=!0}}},[e._v("添加")])],1)],1),r("el-table",{class:{showselectOrgUser:!e.showselectOrgUser},staticStyle:{width:"100%"},attrs:{data:e.tableData,border:""},on:{"expand-change":e.getinfo}},[r("el-table-column",{attrs:{type:"expand",label:"详情"}},[[r("el-form",{staticClass:"demo-table-expand",attrs:{"label-position":"left",inline:""}},[r("el-form-item",{attrs:{label:"公司"}},[r("span",[e._v(e._s(e.selectUserInfo.subcompanyid1))])]),r("el-form-item",{attrs:{label:"部门"}},[r("span",[e._v(e._s(e.selectUserInfo.departmentid))])]),r("el-form-item",{attrs:{label:"手机"}},[r("span",[e._v(e._s(e.selectUserInfo.mobile))])]),r("el-form-item",{attrs:{label:"邮箱"}},[r("span",[e._v(e._s(e.selectUserInfo.email))])])],1)]],2),r("el-table-column",{attrs:{prop:"empNo",label:"账号"}}),r("el-table-column",{attrs:{prop:"userName",label:"姓名"}}),r("el-table-column",{attrs:{label:"状态"},scopedSlots:e._u([{key:"default",fn:function(t){return[0==t.row.isEffect?r("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(r){e.updateisEffect(t.row.id,1)}}},[e._v("点击启用")]):r("el-button",{attrs:{size:"mini",type:"success"},on:{click:function(r){e.updateisEffect(t.row.id,0)}}},[e._v("点击禁用")])]}}])}),r("el-table-column",{attrs:{label:"上次登录时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("i",{staticClass:"el-icon-time"}),0==t.row.loginTime?r("span",[e._v(" 未登录 ")]):r("span",[e._v("\n          "+e._s(e.$moment.unix(t.row.loginTime).format("YYYY-MM-DD HH:mm:ss"))+"\n        ")])]}}])}),r("el-table-column",{attrs:{label:"操作",width:"260px"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(r){e.showRoleDialog=!0,e.editUser=t.row}}},[e._v("\n          编辑角色\n        ")]),r("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(r){e.updatePassword(t.row.empNo)}}},[e._v("重置密码")]),r("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(r){e.remove(t.row.id)}}},[e._v("删除")])]}}])})],1),r("el-pagination",{attrs:{"current-page":e.page.curPage,"page-sizes":[10,20,30,50],"page-size":e.page.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":function(t){return e.page.pageSize=t},"current-change":function(t){return e.page.curPage=t}}}),r("el-dialog",{attrs:{title:"选择用户",visible:e.showDialog},on:{"update:visible":function(t){e.showDialog=t}}},[r("orgTree",{attrs:{select:e.selectOrgUser},on:{"update:select":function(t){e.selectOrgUser=t}}}),r("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:function(t){e.showDialog=!1}}},[e._v("取 消")]),r("el-button",{attrs:{type:"primary"},on:{click:e.add}},[e._v("确 定")])],1)],1),r("editUserRole",{attrs:{show:e.showRoleDialog,user:e.editUser},on:{"update:show":function(t){e.showRoleDialog=t}}})],1)},s=[],a=(r("96cf"),r("1da1")),i=(r("cadf"),r("551c"),r("097d"),function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("el-dialog",{attrs:{title:e.user.empNo,visible:e.show},on:{"update:visible":function(t){e.$emit("update:show",!1)}}},[r("el-tree",{ref:"roleTree",attrs:{data:e.tree,props:e.defaultProps,"show-checkbox":"","node-key":"id"}}),r("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:function(t){e.$emit("update:show",!1)}}},[e._v("取 消")]),r("el-button",{attrs:{type:"primary"},on:{click:e.editrole}},[e._v("确 定")])],1)],1)}),o=[],c=r("8680"),l={name:"editUserRole",data:function(){return{defaultProps:{children:"children",label:"roleName"}}},props:["user","show"],asyncComputed:{tree:function(){var e=Object(a["a"])(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,c["d"].get();case 2:return t=e.sent,e.abrupt("return",t.list);case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},watch:{user:function(){var e=Object(a["a"])(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:this.refreshSelects(t);case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},methods:{refreshSelects:function(){var e=Object(a["a"])(regeneratorRuntime.mark(function e(t){var r;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return this.$refs.roleTree&&this.$refs.roleTree.setCheckedKeys([]),e.next=3,c["f"].getUserRoles(t.id);case 3:r=e.sent,r=r.map(function(e){return e.roleId}),this.$refs.roleTree.setCheckedKeys(r);case 6:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),editrole:function(){var e=Object(a["a"])(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return t=this.$refs.roleTree.getCheckedNodes().map(function(e){return e.id}),e.next=3,c["f"].saveUserRole(this.user.id,t);case 3:if(!e.sent){e.next=6;break}this.$message({type:"success",message:"角色更新成功!",duration:500}),this.$emit("update:show",!1);case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()}},u=l,p=r("2877"),f=Object(p["a"])(u,i,o,!1,null,null,null);f.options.__file="editUserRole.vue";var d=f.exports,h=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("el-tree",{ref:"orgTree",attrs:{props:e.treeprops,load:e.loadNode,lazy:"","show-checkbox":"","node-key":"id"},on:{"check-change":e.handleClick}})},m=[],g={name:"orgTree",data:function(){return{treedata:null,selects:[],treeprops:{label:"name",children:"deparments",isLeaf:"leaf"}}},methods:{loadNode:function(){var e=Object(a["a"])(regeneratorRuntime.mark(function e(t,r){var n;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(null!=this.treedata){e.next=5;break}return e.next=3,c["c"].OrgTree();case 3:this.treedata=e.sent,this.treedata=this.treedata.children.map(function(e){var t=e;return t.disabled=!0,t.deparments=t.deparments.map(function(e){var t=e;return t.disabled=!0,t}),t});case 5:if(0!==t.level){e.next=7;break}return e.abrupt("return",r(this.treedata));case 7:if(!t.data.deparments||0===t.data.deparments.length){e.next=9;break}return e.abrupt("return",r(t.data.deparments));case 9:if(!t.data.id){e.next=15;break}return e.next=12,c["c"].OrgFindEmp({departmentid:t.data.id});case 12:return n=e.sent,n=n.map(function(e){var t=e;return t.name=e.lastname,t.leaf=!0,t}),e.abrupt("return",r(n));case 15:return e.abrupt("return",r([]));case 16:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}(),handleClick:function(e,t){e.leaf&&t&&(this.$refs.orgTree.setCheckedNodes([e]),this.selects=this.$refs.orgTree.getCheckedNodes().filter(function(e){return e.leaf}),this.$emit("update:select",this.selects[0]))}}},b=g,w=Object(p["a"])(b,h,m,!1,null,null,null);w.options.__file="orgTree.vue";var v=w.exports,y=r("2ef0"),k=r.n(y),x={empNo:null,userName:null,id:null,isEffect:null,loginSum:null,operateID:null,loginTime:null,loginIp:null,lastLoginIp:null,lastLoginTime:null},O={loginid:null,departmentid:null,mobile:null,id:null,subcompanyid1:null,email:null,lastname:null},N={empNo:"",userName:""},_={data:function(){return{search:JSON.parse(JSON.stringify(N)),debounceSearch:JSON.parse(JSON.stringify(N)),page:Object(c["a"])(),selectUser:JSON.parse(JSON.stringify(x)),showDialog:!1,selectOrgUser:null,showselectOrgUser:!1,total:0,showRoleDialog:!1,editUser:JSON.parse(JSON.stringify(x))}},components:{orgTree:v,editUserRole:d},asyncComputed:{tableData:function(){var e=Object(a["a"])(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,c["f"].get(this.debounceSearch,this.page);case 2:return t=e.sent,this.total=t.total,this.page.curPage=this.page.curPage<t.pages?this.page.curPage:t.pages,e.abrupt("return",t.list);case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),selectUserInfo:{get:function(){var e=Object(a["a"])(regeneratorRuntime.mark(function e(){var t,r,n;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(t=JSON.parse(JSON.stringify(O)),r=0,!this.selectUser.empNo){e.next=7;break}return e.next=5,c["c"].OrgFindEmp({loginid:this.selectUser.empNo});case 5:n=e.sent,n.length>0&&(t=n[r]);case 7:return this.showselectOrgUser=!0,e.abrupt("return",t);case 9:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),default:JSON.parse(JSON.stringify(O))}},watch:{search:{handler:k.a.debounce(function(e){this.debounceSearch=JSON.parse(JSON.stringify(e)),this.page.curPage=1},500),deep:!0}},methods:{refresh:function(){this.debounceSearch=JSON.parse(JSON.stringify(this.debounceSearch))},getinfo:function(e,t){t.length>1&&t.shift(),this.selectUser!==e&&t.length>0&&(this.showselectOrgUser=!1,this.selectUser=e)},add:function(){var e=Object(a["a"])(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,c["f"].add({empNo:this.selectOrgUser.loginid});case 2:if(!e.sent){e.next=5;break}this.$message({type:"success",message:"添加成功!",duration:500}),this.refresh();case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),updateisEffect:function(){var e=Object(a["a"])(regeneratorRuntime.mark(function e(t,r){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,c["f"].update({id:t,isEffect:r});case 2:if(!e.sent){e.next=5;break}this.$message({type:"success",message:"状态修改成功!",duration:500}),this.refresh();case 5:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}(),updatePassword:function(){var e=Object(a["a"])(regeneratorRuntime.mark(function e(t){var r=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:this.$confirm("此操作将重置密码, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(Object(a["a"])(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,c["f"].resetPassword(t);case 2:if(!e.sent){e.next=4;break}r.$message({type:"success",message:"重置密码成功!",duration:500});case 4:case"end":return e.stop()}},e,this)})));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),remove:function(){var e=Object(a["a"])(regeneratorRuntime.mark(function e(t){var r=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:this.$confirm("此操作将永久删除该, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(Object(a["a"])(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,c["f"].deleteByIds(t);case 2:if(!e.sent){e.next=5;break}r.$message({type:"success",message:"删除成功!",duration:500}),r.refresh();case 5:case"end":return e.stop()}},e,this)})));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}},R=_,S=(r("daac"),Object(p["a"])(R,n,s,!1,null,null,null));S.options.__file="index.vue";t["default"]=S.exports},daac:function(e,t,r){"use strict";var n=r("5960"),s=r.n(n);s.a}}]);
//# sourceMappingURL=editUser.25a21f3c.js.map